# 角色框架与玩家数据设计
- 使用5E规则打底

## 目标
- 定义统一角色框架，覆盖玩家角色、NPC 角色、怪物角色。
- 提供可直接落地到数据模型的 DND 5E 角色卡模板。
- 将玩家信息与地图/聊天流程解耦，支持长期成长扩展。
- 保证后续扩展（装备、任务、战斗）时不破坏已有存档。

## 角色类型
- `player`：玩家角色，由玩家创建与长期成长。
- `npc`：非玩家角色，由系统生成或剧情配置。
- `monster`：怪物角色，用于遭遇与战斗。

## 通用角色属性枚举
- 角色类型
- 角色ID
- 角色名称
- 角色等级
- 角色升级所需经验
- 角色当前经验
- 角色当前移动速度
- 力量
- 当前力量
- 力量加值
- 当前力量加值
- 敏捷
- 当前敏捷
- 敏捷加值
- 当前敏捷加值
- 体质
- 当前体质
- 体质加值
- 当前体质加值
- 智力
- 当前智力
- 智力加值
- 当前智力加值
- 感知
- 当前感知
- 感知加值
- 当前感知加值
- 魅力
- 当前魅力
- 魅力加值
- 当前魅力加值
- 角色BUFF列表
- 角色当前装备的武器
- 角色当前装备的护甲
- AC
- DC
- 背包
- 技能池
- 法术池
- 法术位
- 当前法术位
- 体力值
- 当前体力值
- 角色当前状态
- 熟练项
- 特质
- HP
- 当前HP
- 是否死亡
- 关系列表（角色ID、关系标签、简述；NPC 初始预生成 1~2 条，不含玩家，玩家交互后才加入玩家关系）


## 玩家数据面板规则
### 核心体验规则
- 玩家数据面板由 Debug 面板进入。
- 修改后立即生效，不需要重启会话。

### 交互约束
- 必填字段不可为空（如角色名、核心标识）。
- 非法数值输入应被阻断或回退到安全默认值。
- 保存成功后应刷新当前会话中依赖该数据的功能。

## BUFF属性枚举
- BUFF名称
- BUFF描述
- BUFF持续时间

## 属性计算公式
- AC = 武器攻击力 + 力量加值（力量武器）+ 敏捷加值（敏捷武器）+ BUFF影响
- DC = 敏捷加值（若没有穿重甲） + BUFF影响
- 所有当前值 = 基础值 + BUFF影响

## NPC独有属性枚举
- 性格
- 说话方式
- 外貌
- 外观
- 角色背景
- 认知
- 阵营

## NPC单聊体验规则
- 玩家点击“可交互NPC”按钮后，进入该 NPC 的单独聊天模式。
- 进入单聊时先请求 NPC 问候语，问候阶段弹出等待遮罩并阻塞玩家操作，直到 AI 返回。
- 问候语必须符合“玩家刚靠近 NPC 的第一反应”语境：自然口语、短句、可落地，不使用旁白式诗化表达。
- 单聊支持流式输出；玩家可随时返回主聊天。
- 单聊中的每轮对话（玩家发言/NPC回复）都必须写入该 NPC 角色卡内的聊天记录。
- 聊天记录必须是结构化内容，至少包含：世界日期、世界时间、说话方、文本内容。
- AI 在单聊生成时必须使用该 NPC 历史聊天记录作为上下文，确保“即时性”和连续性。

## 验收标准
- 可读取与保存玩家静态数据。
- 移动速度修改后，移动耗时计算即时变化。
- 旧存档读取时可补齐缺失角色字段。
- NPC 单聊可进入/退出，问候阶段有阻塞等待提示。
- NPC 单聊记录可在角色池详情中查看到带时间戳的结构化条目。

## 背包设计
- 当前金币数量
- 其他物品列表
- 所有物品都是Item包括玩家的武器、护甲等
- 玩家在背包中可以装备武器和护甲和选取道具
- 武器和护甲类型在背包中点击后可以选择是否装备
- 其他类型的Item点击，弹出聊天框，玩家可以输入如何使用或者观察这个Item,输入prompt；AI 返回是否需要检定和时间消耗


## item属性枚举
- （占位）名称、类型、描述、重量、稀有度、价值、效果、可用次数、冷却、绑定状态

## 相关api和AI工具
- 获取所有角色属性
- 更改角色武器
- 更改角色装甲
- 给予角色BUFF
- 给予角色道具
- 移除角色道具
- 移除角色BUFF
- 给予角色法术
- 移除角色法术
- 给予角色技能
- 移除角色技能
- 角色使用技能/法术
- 消耗法术位
- 恢复法术位
- 消耗体力值
- 回复体力值
- 改变角色属性
- 查看/更新角色关系
