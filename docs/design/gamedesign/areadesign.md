# 区块内容设计

用于定义区块系统的体验规则，并明确 AI 生成与代码逻辑的职责边界。

## 当前阶段目标（M1）
- 大区块与子区块同批生成，并持久化到存档。
- 移动成本可计算、可提示、可累计到全局时钟。
- 关键交互与 NPC 提供占位可点击闭环。
- 地图与左栏可直观看到区块范围、名称、当前位置。

## AI 与逻辑的分工（核心约束）
`逻辑层必须保证`：
- 坐标与距离计算（`x/y/z`）和耗时计算正确。
- 区块半径、子区块数量、子区块坐标范围不越界。
- 大区块不重叠（中心距 > 半径和）。
- 存档一致性（当前大区块/子区块、交互、NPC、时钟不丢失）。
- 占位交互固定返回“待开发”。

`AI 负责`：
- 区块/子区块语义名称与描述。
- 玩家移动后的叙事文本（可选）。
- 玩家主动“发现”时的新增交互候选。

`AI 失败时`：
- 回退到逻辑默认值（默认子区块、默认交互、默认 NPC、默认文本），流程不断。

## 区块生成规则
- 每个大区块必须有：`zone_type`、`size`、`radius_m`、中心坐标、描述。
- 子区块在生成大区块时同时生成，不再等玩家进入后才生成。
- 子区块坐标为“相对中心偏移 + 中心点”转换出的绝对坐标。
- 子区块坐标到中心点的距离不得大于大区块半径。
- 大区块间不能交叉：任意两大区块中心距离必须大于两区块半径之和。
- 子区块数量按规模约束：
  - `small`: 3~5
  - `medium`: 5~10
  - `large`: 8~15
- 每个大区块生成时同步生成 NPC：为每个区块/子区块生成完整 NPC 角色卡并写入本地存档的“角色池”。

## 区块范围与地图表现
- 大区块信息必须包含准确半径（米）。
- 二维地图以大区块中心为圆心绘制范围圈，并在圈内显示大区块名称。
- 子区块在二维地图以点位绘制，点旁显示子区块名称。
- 地图中不显示可互动物品和可交互 NPC，保持视图清爽。

## 移动与时间规则
- 玩家进入大区块时落在该大区块中心点（路径计算基准）。
- 玩家状态同时记录：
  - 当前大区块 `current_zone_id`
  - 当前子区块 `current_sub_zone_id`
- 允许从任意子区块移动到另一个大区块的子区块，按坐标计算耗时。
- 从中心点到子区块应有非零耗时（除非目标与当前位置相同）。
- 移动前在 UI 显示预计耗时；移动后全局时钟累加。
- 若移动目标与当前子区块相同，给“你已在 xx”提示弹窗。

## 全局时钟
- 新游戏默认初始化剑与魔法时间：`xxx年xxx月xxx日xxx时xxx分`。
- 移动、发现交互、执行交互都会推进时钟。
- 所有刷新与状态判断以服务端时钟为准，不依赖客户端本地时间。

## 交互与聊天表现
- 可互动物品与可交互 NPC 只在当前子区块到达后显示在聊天区。
- 关键交互预生成；非关键交互由玩家主动触发“发现”即时生成。
- 当前阶段交互与 NPC 均为占位，点击后返回“待开发”。
- 聊天框仅保留当前 AI 回复，不保留完整上下文历史。

## 左栏与面板行为
- 当前大区块高亮显示。
- 当前大区块默认展开子区块列表。
- 从一个大区块移动到另一大区块后，旧大区块子列表应折叠。
- 大区块条目展示：类型、规模、半径。
- 子区块条目展示：名称与预计移动分钟数。

## 当前阶段不做
- 深度 NPC 行为系统（排班、关系网、长期记忆）。
- 交互结果结算与任务链推进。
- 区块状态复杂演化（经济、势力、事件持续影响）。
